<div class="detail-header">
  <h1 class="detail-title"><%= @meeting_minute.title %></h1>
  <div class="detail-meta">
    <% if @meeting_minute.start_time && @meeting_minute.end_time %>
      <%= @meeting_minute.start_time.strftime("%Y年%m月%d日 %H:%M") %> 〜 <%= @meeting_minute.end_time.strftime("%H:%M") %>
      （<%= @meeting_minute.duration_minutes %>分）
    <% else %>
      日時未設定
    <% end %>
    / 作成者: <%= link_to @meeting_minute.employee.name, employee_path(@meeting_minute.employee) %>
  </div>
  <% if @meeting_minute.start_time && @meeting_minute.end_time %>
    <div class="detail-cost">
      概算コスト: <strong><%= number_with_delimiter(@meeting_minute.estimated_cost.to_i) %>円</strong>
    </div>
  <% end %>
</div>

<% if @meeting_minute.shared_employees.any? %>
  <div class="shared-info">
    <span class="shared-label">共有先:</span>
    <% @meeting_minute.shared_employees.each do |employee| %>
      <span class="shared-employee"><%= employee.name %></span>
    <% end %>
  </div>
<% end %>

<% if @meeting_minute.audio.attached? %>
  <div class="detail-section">
    <h2 class="section-title">音声</h2>
    <audio controls class="audio-player">
      <source src="<%= rails_blob_path(@meeting_minute.audio, disposition: 'inline') %>" type="<%= @meeting_minute.audio.content_type %>">
      お使いのブラウザは音声再生に対応していません。
    </audio>
    <p class="audio-info"><%= @meeting_minute.audio.filename %> (<%= number_to_human_size(@meeting_minute.audio.byte_size) %>)</p>
  </div>
<% end %>

<% if @meeting_minute.transcription.present? %>
  <div class="detail-section">
    <h2 class="section-title">文字起こし（AI生成）</h2>
    <div class="transcription-content">
      <%= simple_format(@meeting_minute.transcription) %>
    </div>
  </div>
<% elsif @meeting_minute.audio.attached? %>
  <div class="detail-section">
    <h2 class="section-title">文字起こし</h2>
    <% case @meeting_minute.transcription_status %>
    <% when "pending" %>
      <p class="transcription-status">文字起こし待機中...</p>
    <% when "processing" %>
      <p class="transcription-status">文字起こし処理中...</p>
    <% when "failed" %>
      <p class="transcription-status error">文字起こしに失敗しました</p>
    <% end %>
  </div>
<% end %>

<div class="detail-section">
  <h2 class="section-title">議事内容</h2>
  <div class="detail-content">
    <%= simple_format(@meeting_minute.content) %>
  </div>
</div>

<div class="detail-actions">
  <% if @meeting_minute.employee_id == current_employee.id %>
    <%= link_to "編集", edit_meeting_minute_path(@meeting_minute), class: "btn" %>
    <%= button_to "削除", meeting_minute_path(@meeting_minute), method: :delete, class: "btn btn-danger", data: { turbo_confirm: "本当に削除しますか？" } %>
  <% end %>
  <%= link_to "一覧に戻る", meeting_minutes_path, class: "btn" %>
</div>
